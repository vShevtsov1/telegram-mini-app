import "./style.scss"
import {useEffect, useState} from "react";
import axios from "axios";
import {useNavigate} from "react-router-dom";

const Profile = () => {
    const [user, setUser] = useState(null);
    const [userData,setUserData] = useState(null);
    const navigate = useNavigate();
    useEffect(() => {
        const tg = window.Telegram?.WebApp;

        if (!tg) {
            console.warn("Telegram WebApp not available");
            return;
        }

        const initData = tg.initData;
        setUserData(initData);

        axios.post("https://server.traff-baza.online/telegram/verify", null, {
            params: {
                initData: initData
            }
        }).then(res => {
            if (res.data.status === "ok") {
                const userData = res.data.user;
                setUser(userData);

            } else {
                console.error("❌ Ошибка проверки:", res.data.message);
            }
        }).catch(err => {
            console.error("⚠️ Ошибка запроса:", err);
        });
    }, []);

    const options = [
        {
            icon: (
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">
                    <path d="M9.05851 28.068C6.47751 27.278 4.58201 25.897 3.37201 23.925C2.16201 21.953 1.55701 19.978 1.55701 18C1.55701 16.022 2.16201 14.047 3.37201 12.075C4.58201 10.103 6.47701 8.7225 9.05701 7.9335V9.525C7.28301 10.125 5.83951 11.2 4.72651 12.75C3.61351 14.3 3.05751 16.05 3.05851 18C3.05951 19.95 3.61551 21.7 4.72651 23.25C5.83751 24.8 7.28151 25.875 9.05851 26.475V28.068ZM21.0585 28.5C18.1365 28.5 15.656 27.48 13.617 25.44C11.578 23.4 10.558 20.92 10.557 18C10.556 15.08 11.576 12.6 13.617 10.56C15.658 8.52 18.138 7.5 21.057 7.5C22.419 7.5 23.714 7.745 24.942 8.235C26.172 8.725 27.2695 9.415 28.2345 10.305L27.174 11.3655C26.368 10.6175 25.45 10.0365 24.42 9.6225C23.39 9.2075 22.269 9 21.057 9C18.557 9 16.432 9.875 14.682 11.625C12.932 13.375 12.057 15.5 12.057 18C12.057 20.5 12.932 22.625 14.682 24.375C16.432 26.125 18.557 27 21.057 27C22.269 27 23.39 26.793 24.42 26.379C25.45 25.964 26.3675 25.3825 27.1725 24.6345L28.2345 25.6965C27.2695 26.5845 26.1725 27.2735 24.9435 27.7635C23.7145 28.2545 22.4195 28.5 21.0585 28.5ZM29.481 22.962L28.419 21.9L31.569 18.75H19.731V17.25H31.569L28.419 14.1L29.481 13.038L34.443 18L29.481 22.962Z" fill="white"/>
                </svg>
            ),
            label: "Баланс",
            value: "$0.00",
        },
        {
            icon: (
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">
                    <path d="M19 31V18.8454M19 31L8.43657 24.3119C7.732 23.8667 7.38057 23.6434 7.19029 23.3168C7 22.9901 7 22.6057 7 21.84V11.2487M19 31L29.5651 24.3119C30.268 23.8667 30.6194 23.6434 30.8097 23.3168C31 22.9901 31 22.6057 31 21.84V11.2487M19 18.8454L7 11.2487M19 18.8454L31 11.2487M7 11.2487L17.008 4.91312C17.968 4.30538 18.4514 4 19 4C19.5486 4 20.0303 4.30387 20.992 4.91312L31 11.2487" stroke="white" stroke-width="1.5" stroke-linejoin="round"/>
                </svg>
            ),
            label: "Замовлення",
            value: null,
            link: "/orders"
        },
        {
            icon: (
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">
                    <path d="M18.0585 25.7025C18.3905 25.7025 18.6705 25.5885 18.8985 25.3605C19.1265 25.1325 19.2405 24.8525 19.2405 24.5205C19.2405 24.1865 19.1265 23.9055 18.8985 23.6775C18.6705 23.4505 18.3905 23.337 18.0585 23.337C17.7265 23.337 17.446 23.4505 17.217 23.6775C16.988 23.9045 16.874 24.185 16.875 24.519C16.876 24.853 16.99 25.133 17.217 25.359C17.444 25.585 17.7255 25.6995 18.0585 25.7025ZM17.2845 20.7345H18.7335C18.7715 20.0645 18.8955 19.532 19.1055 19.137C19.3155 18.74 19.7165 18.2455 20.3085 17.6535C21.0285 16.9325 21.551 16.3075 21.876 15.7785C22.2 15.2485 22.362 14.6465 22.362 13.9725C22.362 12.8025 21.96 11.859 21.156 11.142C20.352 10.425 19.3705 10.0665 18.2115 10.0665C17.1435 10.0665 16.2245 10.3515 15.4545 10.9215C14.6845 11.4905 14.1215 12.173 13.7655 12.969L15.1455 13.5405C15.3965 12.9425 15.756 12.447 16.224 12.054C16.691 11.66 17.3225 11.463 18.1185 11.463C19.0625 11.463 19.7645 11.7215 20.2245 12.2385C20.6845 12.7545 20.9145 13.3415 20.9145 13.9995C20.9145 14.5005 20.7765 14.96 20.5005 15.378C20.2255 15.795 19.8405 16.2335 19.3455 16.6935C18.5385 17.4375 17.9935 18.1075 17.7105 18.7035C17.4275 19.2995 17.2855 19.9765 17.2845 20.7345ZM6 30V6H30V30H6ZM7.5 28.5H28.5V7.5H7.5V28.5Z" fill="white"/>
                </svg>
            ),
            label: "Підтримка",
            value: null,
        },
        {
            icon: (
                <svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 30V6H30V30H6ZM7.5 28.5H28.5V7.5H7.5V28.5Z" fill="white"/>
                    <path d="M16.824 20.725L16.577 11.567H18.914L18.667 20.725H16.824ZM17.755 22.397C18.173 22.397 18.5087 22.53 18.762 22.796C19.0153 23.0493 19.142 23.385 19.142 23.803C19.142 24.2083 19.009 24.5377 18.743 24.791C18.4897 25.0317 18.1603 25.152 17.755 25.152C17.337 25.152 17.0013 25.0317 16.748 24.791C16.4947 24.5503 16.368 24.221 16.368 23.803C16.368 23.385 16.4947 23.0493 16.748 22.796C17.0013 22.53 17.337 22.397 17.755 22.397Z" fill="white"/>
                </svg>

            ),
            label: "Правила",
            value: null,
        },
        {
            icon: (
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M19.143 7.8C20.3519 6.62896 21.9727 5.98012 23.6557 5.99349C25.3387 6.00686 26.9489 6.68136 28.139 7.87146C29.3291 9.06156 30.0036 10.6718 30.017 12.3548C30.0304 14.0379 29.3815 15.6586 28.2105 16.8675L28.2015 16.8765L24.804 20.274C24.1538 20.9237 23.3715 21.4261 22.5102 21.7472C21.6488 22.0683 20.7286 22.2005 19.8117 22.1349C18.8948 22.0694 18.0027 21.8075 17.1959 21.3672C16.389 20.9268 15.6862 20.3182 15.135 19.5825C15.0157 19.4234 14.9644 19.2233 14.9925 19.0264C15.0207 18.8295 15.1259 18.6518 15.285 18.5325C15.4441 18.4132 15.6442 18.3619 15.8411 18.39C16.038 18.4182 16.2157 18.5234 16.335 18.6825C16.7569 19.2467 17.2952 19.7135 17.9134 20.0514C18.5316 20.3892 19.2153 20.5901 19.9179 20.6405C20.6206 20.6908 21.3259 20.5895 21.986 20.3433C22.6461 20.097 23.2455 19.7118 23.7435 19.2135L27.1365 15.8205C28.0253 14.8928 28.5154 13.6538 28.5015 12.3691C28.4877 11.0844 27.9712 9.85628 27.0626 8.94791C26.154 8.03954 24.9258 7.52326 23.6411 7.50972C22.3564 7.49619 21.1175 7.98648 20.19 8.8755L18.246 10.8075C18.1766 10.8789 18.0937 10.9358 18.0021 10.9748C17.9105 11.0138 17.812 11.0342 17.7124 11.0348C17.6129 11.0354 17.5142 11.0161 17.4221 10.9781C17.3301 10.9402 17.2465 10.8843 17.1763 10.8136C17.1061 10.743 17.0506 10.6592 17.0132 10.5669C16.9757 10.4746 16.957 10.3758 16.9582 10.2763C16.9593 10.1767 16.9803 10.0784 17.0198 9.98697C17.0594 9.89559 17.1167 9.81299 17.1885 9.744L19.143 7.8ZM13.488 14.25C14.7867 13.7654 16.2075 13.7147 17.5374 14.1055C18.8673 14.4962 20.0348 15.3074 20.865 16.4175C20.9844 16.5766 21.0356 16.7767 21.0075 16.9736C20.9793 17.1705 20.8741 17.3482 20.715 17.4675C20.5559 17.5868 20.3558 17.6381 20.1589 17.61C19.962 17.5818 19.7843 17.4766 19.665 17.3175C19.2428 16.7535 18.7043 16.2868 18.086 15.9491C17.4677 15.6114 16.784 15.4106 16.0812 15.3603C15.3785 15.3099 14.6732 15.4112 14.013 15.6573C13.3529 15.9033 12.7533 16.2885 12.255 16.7865L8.865 20.1795C7.98302 21.1083 7.49869 22.3449 7.51526 23.6257C7.53182 24.9065 8.04797 26.1301 8.95368 27.0358C9.8594 27.9415 11.083 28.4577 12.3638 28.4742C13.6446 28.4908 14.8812 28.0065 15.81 27.1245L17.7435 25.194C17.885 25.0574 18.0744 24.9818 18.2711 24.9835C18.4677 24.9852 18.6558 25.0641 18.7949 25.2031C18.9339 25.3422 19.0128 25.5303 19.0145 25.7269C19.0162 25.9236 18.9406 26.1131 18.804 26.2545L16.857 28.2C15.6481 29.371 14.0274 30.0199 12.3443 30.0065C10.6613 29.9931 9.05107 29.3186 7.86097 28.1285C6.67087 26.9384 5.99636 25.3282 5.98299 23.6452C5.96962 21.9622 6.61846 20.3414 7.7895 19.1325L7.7985 19.1235L11.196 15.726C11.8466 15.0761 12.6285 14.5729 13.4895 14.25" fill="white"/>
                </svg>
            ),
            label: "Реферальне посилання",
            value: null,
            link:"/referal"
        },

    ];

    if(user === null){
        return userData
    }
    return (<div className={"profile-page"}>
    <img src="/bg/Profile/1.svg" alt="bg1" className="bg-svg bg-1" />
    <img src="/bg/Profile/2.svg" alt="bg2" className="bg-svg bg-2" />
    <img src="/bg/Profile/3.svg" alt="bg3" className="bg-svg bg-3" />

    <div className="profile-content">
        {userData}
        <div className="header">
            <h1 className="title">Профіль</h1>
            <img src="/bg/Category/4.svg" alt="bg1"  />
        </div>
        <div className="user-data">
            <h1>{user.first_name||""} {user.last_name||""}</h1>
            <p>@{user.username||""}</p>
        </div>
        <div className="menu-options">
            {options.map((opt, idx) => (
                <div onClick={()=>navigate(opt.link)} className="options" key={idx}>
                    <div className="data">
                        {opt.icon}
                        <p>{opt.label}</p>
                    </div>
                    {opt.value && <div className="add_data">$ {user.balance||0}</div>}
                </div>
            ))}
        </div>

    </div>
</div>)
}
export default Profile